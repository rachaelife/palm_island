<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîó Backend API Integration Test</h1>
    
    <div class="test-section">
        <h2>1. Server Health Check</h2>
        <button onclick="testServerHealth()">Test Server Connection</button>
        <div id="health-result"></div>
    </div>

    <div class="test-section">
        <h2>2. User Registration</h2>
        <input type="text" id="reg-name" placeholder="Full Name" value="Test User">
        <input type="email" id="reg-email" placeholder="Email" value="test@example.com">
        <input type="password" id="reg-password" placeholder="Password" value="testpass123">
        <select id="reg-role">
            <option value="user">User</option>
            <option value="coach">Coach</option>
            <option value="bidder">Bidder</option>
        </select>
        <button onclick="testRegistration()">Test Registration</button>
        <div id="registration-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Email Verification</h2>
        <input type="text" id="verify-token" placeholder="Verification Token">
        <button onclick="testEmailVerification()">Test Email Verification</button>
        <div id="verification-result"></div>
    </div>

    <div class="test-section">
        <h2>4. User Login</h2>
        <input type="email" id="login-email" placeholder="Email" value="test@example.com">
        <input type="password" id="login-password" placeholder="Password" value="testpass123">
        <button onclick="testLogin()">Test Login</button>
        <div id="login-result"></div>
    </div>

    <div class="test-section">
        <h2>5. Resend Verification</h2>
        <input type="email" id="resend-email" placeholder="Email" value="test@example.com">
        <button onclick="testResendVerification()">Test Resend Verification</button>
        <div id="resend-result"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000';

        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="log ${isError ? 'error' : 'success'}">${message}</div>`;
        }

        async function makeRequest(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            console.log(`Making request to: ${url}`);
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers,
                },
                ...options,
            };

            try {
                const response = await fetch(url, config);
                const data = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        async function testServerHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                const text = await response.text();
                log('health-result', `‚úÖ Server is running!\nResponse: ${text}`);
            } catch (error) {
                log('health-result', `‚ùå Server connection failed: ${error.message}`, true);
            }
        }

        async function testRegistration() {
            const userData = {
                fullname: document.getElementById('reg-name').value,
                email: document.getElementById('reg-email').value,
                password: document.getElementById('reg-password').value,
                role: document.getElementById('reg-role').value
            };

            const result = await makeRequest('/register', {
                method: 'POST',
                body: JSON.stringify(userData)
            });

            if (result.success) {
                log('registration-result', `‚úÖ Registration successful!\nResponse: ${JSON.stringify(result.data, null, 2)}`);
            } else {
                log('registration-result', `‚ùå Registration failed!\nStatus: ${result.status}\nError: ${JSON.stringify(result.data || result.error, null, 2)}`, true);
            }
        }

        async function testEmailVerification() {
            const token = document.getElementById('verify-token').value;
            
            if (!token) {
                log('verification-result', '‚ùå Please enter a verification token', true);
                return;
            }

            const result = await makeRequest(`/verify-email?token=${token}`, {
                method: 'GET'
            });

            if (result.success) {
                log('verification-result', `‚úÖ Email verification successful!\nResponse: ${JSON.stringify(result.data, null, 2)}`);
            } else {
                log('verification-result', `‚ùå Email verification failed!\nStatus: ${result.status}\nError: ${JSON.stringify(result.data || result.error, null, 2)}`, true);
            }
        }

        async function testLogin() {
            const credentials = {
                email: document.getElementById('login-email').value,
                password: document.getElementById('login-password').value
            };

            const result = await makeRequest('/login', {
                method: 'POST',
                body: JSON.stringify(credentials)
            });

            if (result.success) {
                log('login-result', `‚úÖ Login successful!\nResponse: ${JSON.stringify(result.data, null, 2)}`);
            } else {
                log('login-result', `‚ùå Login failed!\nStatus: ${result.status}\nError: ${JSON.stringify(result.data || result.error, null, 2)}`, true);
            }
        }

        async function testResendVerification() {
            const email = document.getElementById('resend-email').value;
            
            if (!email) {
                log('resend-result', '‚ùå Please enter an email address', true);
                return;
            }

            const result = await makeRequest('/resend-verification', {
                method: 'POST',
                body: JSON.stringify({ email })
            });

            if (result.success) {
                log('resend-result', `‚úÖ Resend verification successful!\nResponse: ${JSON.stringify(result.data, null, 2)}`);
            } else {
                log('resend-result', `‚ùå Resend verification failed!\nStatus: ${result.status}\nError: ${JSON.stringify(result.data || result.error, null, 2)}`, true);
            }
        }

        // Test server health on page load
        window.onload = function() {
            testServerHealth();
        };
    </script>
</body>
</html>
